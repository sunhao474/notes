# summary

1.[闭包](#1)  
2.[执行上下文](#2)
3.[执行栈](#3)

---

## <a id="1">闭包</a>

### 概念
一个绑定了执行环境的函数。与一般函数的区别是：他携带了执行环境。（不难发现，一切javascript函数，皆是闭包）
* 环境部分
    - 环境：函数的词法环境（执行上下文的一部分）
    - 标识符列表：函数中用到的未声明的变量
* 表达式部分:函数体

特别解释：执行上下文：执行时所需的所有信息
执行上下文分为：
* lexical enviroment: 词法环境，当获取变量或者this时使用
* variable environment：变量环境，当声明变量时使用
* code evaluation state: 用于恢复代码执行位置
* Function: 如果当前执行的是函数，标识正在被执行的函数
* ScriptOrModule: 当前执行的是脚本或者模块，表示正在被执行的代码
* realm: 使用的基础库和内置对象实例
* Generator: 仅生成器函数有这个属性，表示当前生成器。

其中Funcion和ScriptOrModule的概念，请去学习js的语法环境加深理解

举例
``` javascript
function outer() {
    var a = 44;
    let inner = function() {
        // a是inner未声明的变量，他在标识符列表中
        console.log(a);
    }

    return inner;
}

outer()();
```

---

## <a id="2">执行上下文</a>
当代码运行时，他需要的所有环境信息。

分为三种：
* 全局执行上下文：只有一个，window
* 函数执行上下文： 每当函数被调用时就会单独创建一个
* Eval执行上下文：运行在eval中的代码。

分为三个阶段：
* 创建阶段：
    - 确定this的值
    - 创建词法环境
        - 全局环境： 没有外部环境的词法环境，有一个全局对象，this的值指向这个全局对象，其外部环境引用为null
        - 函数环境：用户在函数中定义的变量存储在环境记录中，包含了`arguments`对象，其外部环境的引用取决于函数的执行作用域。
    - 创建变量环境
        - 跟词法环境的结构是极其类似的。在es6中，词法环境和变量环境的区别在于前者用于存储函数声明和变量（ `let` 和 `const` ）绑定，而后者仅用于存储变量（ `var` ）绑定
* 执行阶段：
    - 变量的赋值，以及代码的执行。
* 回收阶段：
    - 执行上下文出栈，等待虚拟机回收执行上下文。

---

## <a id="3">执行栈</a>

执行栈（调用栈），先进后出，用于存储代码执行期间创建的所有执行上下文。
1. 当`Javascript`引擎开始执行你第一行脚本代码的时候，它就会创建一个全局执行上下文然后将它压到执行栈中
2. 每当引擎碰到一个函数的时候，它就会创建一个函数执行上下文，然后将这个执行上下文压到执行栈中
3. 引擎会执行位于执行栈栈顶的执行上下文(一般是函数执行上下文)，当该函数执行结束后，对应的执行上下文就会被弹出，然后控制流程到达执行栈的下一个执行上下文