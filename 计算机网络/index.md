# 计算机网络

1. [http](#1)
2. [cdn](#2)
3. [dns](#3)
4. [get/post](#4)

---

<a id="1">http</a>

* http 1.0
    - 每次请求都需要与服务器建立一个`TCP`连接。
* http 1.1
    - 默认支持长连接 `keep-alive`
* http 2.0
    - 多路复用
        - 复用一个tcp链接，客户端和浏览器可以同时发送多个请求，并且不用按照顺序一一对应。
        - 采用二进制格式传输数据，而非 1.x 的文本格式，解析更高效;
        - 采用帧的形式发送，对应上述的二进制格式；多个帧之间可以乱序发送，根据帧首部信息排序。
    - 首部压缩
        - 在客户端和服务器使用*首部表*来跟踪和存储之前发送的键值对，对于相同的数据，不再通过每次请求和相应发送。
        - 首部表在连接存续期内始终存在，由客户端和服务器共同渐进地更新。
    - 服务器推送
        - 允许服务器推送资源给客户端
        - 顺便把一些客户端需要的资源推送给客户端，避免客户端再次创建连接发送请求到服务器获取


---

<a id="2">cdn</a>

内容分发网络。构建在现有网络基础上的只能虚拟网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡、内容分发、调度等功能模块，使用户就近获取所需内容，降低网络拥塞，提高用户的访问相应速度和命中率。

用户在上网的时候不用直接访问源站，而是访问最近的一个cdn节点，术语叫`边缘节点`，其实就是缓存了原站内容的代理服务器。

没使用cdn前：
1. 用户提交域名
2. 浏览器解析域名
3. dns解析得到目的主机ip地址
4. 根据ip地址访问
5. 得到请求回复

使用cdn后：
dns不再返回ip地址，而是一个`cname`( canonical name ) 别名记录，指向 `cdn` 的全局负载均衡。

### 负载均衡系统
由于没有返回 `ip` 地址，本地 `dns` 会向负载均衡系统再次发送请求，进入 `cdn` 的全局负载均衡系统进行智能调度： 
* 观察用户ip地址，推断地理位置，找相对最近的边缘节点。
* 看用户所在运营商网络，找相同网络的边缘节点
* 检查边缘节点负载情况，找负载较轻的节点

综合上述因素寻找最合适的边缘节点，把该节点返回给用户，用户访问该节点的缓存代理

### 缓存代理
cdn 的缓存系统会有选择地缓存最常用的资源。
有两个衡量 cdn 服务质量的指标：
* 命中率
* 回源率
缓存系统也可以划分出层次，分成一级缓存结点和二级缓存结点。一级缓存配置高一些，直连源站，二级缓存配置低一些，直连用户。  
回源的时候二级缓存只会找一级缓存，一级缓存没有才会回源站，有效减少真正的回源。

---

<a id="3">dns</a>

`domain names system` 域名系统，是互联网的一项服务，是进行域名和IP之间进行转换的服务器。  

### 查询方式
* 本地查询：查询本地hosts文件。
* 递归查询：先后查询根服务器、.com服务器、baidu.com域服务器，最终获得答案。如果 A 请求 B，B 作为请求的接收者一定要给 A 想要的答案，只用一次查询
* 迭代查询：如果接收者 B 没有 A 想要的内容，B 将告诉 A，如何去获得这个内容，但是自己并不去发出请求，多次查询。

### 域名缓存
在域名服务器解析的时候，使用缓存保存域名和 `IP` 地址的映射
* 浏览器缓存
* 操作系统缓存，即hosts文件

### 查询过程
解析域名的过程如下，在没有命中的情况下依次往下走：

1. 搜索浏览器缓存
2. 搜索hosts文件中的缓存
3. 请求本地域名服务器，本地域名服务器采用递归查询自身缓存。
4. 向本地域名上级域名服务器进行迭代查询。
    - 本地域名服务器向根域名服务器请求，根域名服务器返回顶级域名服务器地址给本地
    - 本地拿到顶级地址，继续向顶级域名发送请求，获取权限域名服务器地址。
    - 本地拿到权限地址，最终拿到ip地址。
在这个过程中，如果正确命中，路径上的服务器会缓存相应信息。

 ![](https://static.vue-js.com/bec3c740-b78f-11eb-ab90-d9ae814b240d.png)

 ---

 <a id="4">get/post</a>
